!function(){function e(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function t(t){for(var r=1;r<arguments.length;r++){var s=null!=arguments[r]?arguments[r]:{};r%2?e(Object(s),!0).forEach((function(e){var r,n,i,o;r=t,n=e,i=s[e],o=function(e,t){if("object"!=a(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var s=r.call(e,"string");if("object"!=a(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n),(n="symbol"==a(o)?o:String(o))in r?Object.defineProperty(r,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[n]=i})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):e(Object(s)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))}))}return t}function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}"undefined"===a(Craft.Freeform)&&(Craft.Freeform={});var r=function(){var e=window.defaultFormHandle;if("index"===this.settings.context&&void 0!==e)for(var t=0;t<this.$sources.length;t++){var a=$(this.$sources[t]);if(a.data("handle")===e)return a.data("key")}return this.base()},s=function(){if(this.$source){var e=this.$source.data("handle");if("index"===this.settings.context&&"undefined"!=typeof history){var t=this.baseUrl;e&&(t+="/"+e),history.replaceState({},"",Craft.getUrl(t))}}};Craft.Freeform.SubmissionsIndex=Craft.BaseElementIndex.extend({baseUrl:"freeform/submissions",afterInit:function(){this.on("selectSource",$.proxy(this,"updateButton")),this.on("selectSite",$.proxy(this,"updateButton")),this.base()},getViewClass:function(e){return"table"===e?Craft.Freeform.SubmissionsTableView:this.base(e)},getDefaultSort:function(){return["dateCreated","desc"]},getDefaultSourceKey:r,updateButton:s}),Craft.Freeform.SpamSubmissionsIndex=Craft.BaseElementIndex.extend({baseUrl:"freeform/spam",reasonContainer:null,reasonMenuBtn:null,selectedReason:null,getDefaultSourceKey:r,afterInit:function(){var e=this;this.reasonContainer=$("<div></div>"),this.reasonContainer.append($("#spam-reasons").html()),this.reasonMenuBtn=$(".btn.menubtn",this.reasonContainer),this.$statusMenuContainer.before(this.reasonContainer),$("*[data-reason]",this.reasonContainer).on({click:function(a){var r=a.target,s=$(r).data("reason"),n=$(r).text();$(r).addClass("sel").parent().siblings().find("a").removeClass("sel"),e.reasonMenuBtn.text(n),e.selectedReason=s,e.settings.criteria=t(t({},e.settings.criteria),{},{spamReason:s}),e.updateElements()}}),this.on("selectSource",$.proxy(this,"updateButton")),this.on("selectSite",$.proxy(this,"updateButton")),this.base()},updateButton:s}),Craft.Freeform.SubmissionsTableView=Craft.TableElementIndexView.extend({startDate:null,endDate:null,startDatepicker:null,endDatepicker:null,$chartExplorer:null,$totalValue:null,$chartContainer:null,$spinner:null,$error:null,$chart:null,$startDate:null,$endDate:null,afterInit:function(){this.$explorerContainer=$('<div class="chart-explorer-container"></div>').prependTo(this.$container),this.createChartExplorer(),this.base()},getStorage:function(e){return Craft.Freeform.SubmissionsTableView.getStorage(this.elementIndex._namespace,e)},setStorage:function(e,t){Craft.Freeform.SubmissionsTableView.setStorage(this.elementIndex._namespace,e,t)},createChartExplorer:function(){var e=$('<div class="chart-explorer"></div>').appendTo(this.$explorerContainer),t=$('<div class="chart-header"></div>').appendTo(e),a=$('<div class="date-range" />').appendTo(t),r=$('<div class="datewrapper"></div>').appendTo(a),s=$('<div class="datewrapper"></div>').appendTo(a),n=$('<div class="total"></div>').appendTo(t),i=$('<div class="total-value-wrapper"></div>').appendTo(n),o=$('<span class="total-value">&nbsp;</span>').appendTo(i);this.$chartExplorer=e,this.$totalValue=o,this.$chartContainer=$('<div class="chart-container"></div>').appendTo(e),this.$spinner=$('<div class="spinner hidden" />').prependTo(t),this.$error=$('<div class="error"></div>').appendTo(this.$chartContainer),this.$chart=$('<div class="chart"></div>').appendTo(this.$chartContainer),this.$startDate=$('<input type="text" class="text" size="20" autocomplete="off" />').appendTo(r),this.$endDate=$('<input type="text" class="text" size="20" autocomplete="off" />').appendTo(s),this.$startDate.datepicker($.extend({onSelect:$.proxy(this,"handleStartDateChange")},Craft.datepickerOptions)),this.$endDate.datepicker($.extend({onSelect:$.proxy(this,"handleEndDateChange")},Craft.datepickerOptions)),this.startDatepicker=this.$startDate.data("datepicker"),this.endDatepicker=this.$endDate.data("datepicker"),this.addListener(this.$startDate,"keyup","handleStartDateChange"),this.addListener(this.$endDate,"keyup","handleEndDateChange");var l=this.getStorage("startTime")||(new Date).getTime()-2592e6,d=this.getStorage("endTime")||(new Date).getTime();this.setStartDate(new Date(l)),this.setEndDate(new Date(d)),this.loadReport()},handleStartDateChange:function(){this.setStartDate(Craft.Freeform.SubmissionsTableView.getDateFromDatepickerInstance(this.startDatepicker))&&this.loadReport()},handleEndDateChange:function(){this.setEndDate(Craft.Freeform.SubmissionsTableView.getDateFromDatepickerInstance(this.endDatepicker))&&this.loadReport()},setStartDate:function(e){return!(this.startDate&&e.getTime()===this.startDate.getTime()||(this.startDate=e,this.setStorage("startTime",this.startDate.getTime()),this.$startDate.val(Craft.formatDate(this.startDate)),this.endDate&&this.startDate.getTime()>this.endDate.getTime()&&this.setEndDate(new Date(this.startDate.getTime())),0))},setEndDate:function(e){return!(this.endDate&&e.getTime()===this.endDate.getTime()||(this.endDate=e,this.setStorage("endTime",this.endDate.getTime()),this.$endDate.val(Craft.formatDate(this.endDate)),this.startDate&&this.endDate.getTime()<this.startDate.getTime()&&this.setStartDate(new Date(this.endDate.getTime())),0))},loadReport:function(){var e=this.settings.params;e.startDate=Craft.Freeform.SubmissionsTableView.getDateValue(this.startDate),e.endDate=Craft.Freeform.SubmissionsTableView.getDateValue(this.endDate),e.isSpam=!1,this.$spinner.removeClass("hidden"),this.$error.addClass("hidden"),this.$chart.removeClass("error"),Craft.postActionRequest("freeform/api/submissions/get-submission-data",e,$.proxy((function(e,t){if(this.$spinner.addClass("hidden"),"success"===t&&void 0===e.error){this.chart||(this.chart=new Craft.charts.Area(this.$chart));var a=new Craft.charts.DataTable(e.dataTable),r={localeDefinition:e.localeDefinition,orientation:e.orientation,formats:e.formats,dataScale:e.scale};this.chart.draw(a,r),this.$totalValue.html(e.totalHtml)}else{var s=Craft.t("An unknown error occurred.");void 0!==e&&e&&void 0!==e.error&&(s=e.error),this.$error.html(s),this.$error.removeClass("hidden"),this.$chart.addClass("error")}}),this))}},{storage:{},getStorage:function(e,t){return Craft.Freeform.SubmissionsTableView.storage[e]&&Craft.Freeform.SubmissionsTableView.storage[e][t]?Craft.Freeform.SubmissionsTableView.storage[e][t]:null},setStorage:function(e,t,r){"undefined"===a(Craft.Freeform.SubmissionsTableView.storage[e])&&(Craft.Freeform.SubmissionsTableView.storage[e]={}),Craft.Freeform.SubmissionsTableView.storage[e][t]=r},getDateFromDatepickerInstance:function(e){return new Date(e.currentYear,e.currentMonth,e.currentDay)},getDateValue:function(e){return e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()}}),Craft.registerElementIndexClass("Solspace\\Freeform\\Elements\\Submission",Craft.Freeform.SubmissionsIndex),Craft.registerElementIndexClass("Solspace\\Freeform\\Elements\\SpamSubmission",Craft.Freeform.SpamSubmissionsIndex)}();